# Snapshot Audit Report

**Host:** {{ inventory_hostname }}  
**Date:** {{ ansible_date_time.date }} {{ ansible_date_time.time }}  
**Audit Profile:** {{ profile.name | default('default') }}  
**Audit Score:** {{ score | default(0) }}/100

## Key Metrics
- Disk usage (max): {{ linux_base_metrics.disk_usage_max_pct | default('0') }}%
- Memory usage: {{ linux_base_metrics.mem_usage_pct | default('0') }}%
- Load average (1m): {{ linux_base_metrics.load_avg_1m | default('0') }}
- Inactive services: {{ systemd_inactive_services | default([]) | length }}

## Findings
{% if findings is defined and findings | length > 0 %}
{% for finding in findings %}
- {{ finding }}
{% endfor %}
{% else %}
- No findings detected.
{% endif %}

## Module Outputs

{% set descriptions = [
  'System Information',
  'Service Status',
  'Security Baseline',
  'User Audit',
  'Authentication Audit',
  'Network Audit',
  'Time Sync',
  'Compliance (CIS)',
  'NGINX Check',
  'Logs Collected',
  'Updates Status',
  'AI Analysis'
] %}
{% for i in range(files | length) %}
{% set found = files[i]['found'] | default(false) %}
- **{{ descriptions[i] }}:** {% if found %}OK{% else %}MISSING{% endif %}
{% endfor %}

## Detailed Output
{% for file in files | default([]) %}
{% set found = file['found'] | default(false) %}
{% set item_name = file['item'] | default('') | basename %}
{% set content = file['content'] | default('') %}
{% if found %}
### {{ item_name }}
```
{{ content | b64decode }}
```
{% else %}
### {{ item_name }} - NOT FOUND
{% endif %}
{% endfor %}

## AI Analysis
{% if files and files[-1] is defined and files[-1]['found'] %}
{{ files[-1]['content'] | b64decode }}
{% else %}
*AI analysis not available.*
{% endif %}

## Recommendations

- Review any findings and address high-risk items first.
- Validate service statuses for inactive or failed units.
- Apply security updates when appropriate.
- Consider feeding metrics into monitoring (Prometheus textfile collector).

---
*Generated by ops-snapshot-audit toolkit*
